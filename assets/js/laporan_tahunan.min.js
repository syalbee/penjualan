let laporan_tahunan = $("#laporan_tahunan").DataTable({
	responsive: !0,
	scrollX: !0,
	ajax: readUrl,
	columnDefs: [{ searcable: !1, orderable: !1, targets: 0 }],
	order: [[1, "asc"]],
	columns: [
		{ data: null },
		{ data: "nota" },
		{ data: "tanggal" },
		{ data: "total_bayar" },
		{ data: "jumlah_uang" },
		{ data: "action" },
	],
});

function reloadTable() {
	laporan_tahunan.ajax.reload();
}

function detail(a) {
	console.log(a);
	$("#modalDetail").modal("show");

	$.ajax({
		url: readDetail + a,
		type: "post",
		dataType: "json",
		success: (res) => {
			var transaksi = [res];
			console.log(transaksi[0]["data"]);
			$("#nota").html("No Nota : " + res.data.nota);
			$("#tanggal").html("Tanggal : " + res.data.tanggal);
			$("#kasir").html("Kasir : " + res.data.kasir);
			var table = document.getElementById("detailtabel");

			for (let i = 0; i < transaksi[0]["data"]["produk"].length; i++) {
				var row = table.insertRow(i);
				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);
				var cell4 = row.insertCell(3);
				cell1.innerHTML = transaksi[0]["data"]["produk"][i]["nama"];
				cell2.innerHTML = transaksi[0]["data"]["produk"][i]["harga"];
				cell3.innerHTML = transaksi[0]["data"]["produk"][i]["total"];
				cell4.innerHTML =
					transaksi[0]["data"]["produk"][i]["total"] *
					transaksi[0]["data"]["produk"][i]["harga"];
			}
			$("#total").html("Total : " + res.data.total);
			$("#tunai").html("Tunai : " + res.data.bayar);
			$("#kembali").html("Kembalian : " + res.data.kembalian);

			var pelanggan = res.data.pelanggan;
			if (pelanggan != null) {
				$("#namapelanggan").html("Nama : " + res.data.pelanggan.nama);
				$("#pointpelanggan").html("Point : " + res.data.pelanggan.point);
			} else{
                $("#namapelanggan").html("");
				$("#pointpelanggan").html("");
            }
		},
		error: (err) => {
			console.log(err);
		},
	});
}

laporan_tahunan.on("order.dt search.dt", () => {
	laporan_tahunan
		.column(0, { search: "applied", order: "applied" })
		.nodes()
		.each((a, e) => {
			a.innerHTML = e + 1;
		});
});
